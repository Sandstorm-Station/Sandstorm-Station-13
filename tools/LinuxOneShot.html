<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>tools/LinuxOneShot/README.md - Sandstorm Station 13</title></head><body><header><a href="index.html">Sandstorm Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a></header><main><h1>tools/LinuxOneShot/README.md <a href="https://github.com/Sandstorm-Station/Sandstorm-Station-13/blob/539d57aa8436b2cbc5e4f4e4a7ff302ebce6064d/tools/LinuxOneShot/README.md0"><img src="git.png" width="16" height="16" title="tools/LinuxOneShot/README.md0"></a></h1><table class="summary" cellspacing="0"><tr><td colspan="2"><p>This is @Cyberboss rage code</p>
<p>The goal is a one stop solution for hosting /tg/station on linux via Docker. Will not work with Docker on Windows.</p>
<p>This requires Docker with the <code>docker-compose</code> command to be installed on your system. See ubuntu instructions <a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">here</a>. If you fail to find the <code>docker-ce</code> package refer to <a href="https://unix.stackexchange.com/a/363058">this StackOverflow answer</a>.</p>
<p>Some basic configuration options in <code>docker-compose.yml</code> before starting:</p>
<ul>
<li>Change TGS_ADMIN_CKEY to your ckey so you may have initial control over the server.</li>
<li>Change TGS_SCHEMA_MAJOR_VERSION to your repo's latest schema major version.</li>
<li>Change TGS_SCHEMA_MINOR_VERSION to your repo's latest schema minor version.</li>
<li>If you want to change the MariaDB password, there are three locations in the file it must be changed from its default value of <code>ChangeThisInBothMariaDBAndTgsConnectionString</code>.</li>
<li>Change TGS_BYOND to set the initial BYOND version.</li>
<li>Ports are mapped in the form <code>&lt;external&gt;:&lt;internal&gt;</code> NEVER change the internal port. If you want to prevent a service from being exposed, delete/comment out the entire line.
<ul>
<li>The first (3306) is the exposed mariadb port. Do not expose this over the internet without changing the password. In general it's a bad idea.</li>
<li>The second (1337) is the exposed DreamDaemon port</li>
<li>The third (5000) is the exposed TGS API port. Do not expose this over the internet. Setup an HTTPS reverse proxy instead.</li>
</ul>
</li>
<li>Change TGS_REPO to set the repository used. Note, this must be a /tg/ derivative from at least 2019 that implements the latest TGS <a href="https://github.com/tgstation/tgstation-server#integrating">DreamMaker API</a>. Repositories that follow tgstation/tgstation will have this automatically. It also must contain a prefixed SQL schema setup file.</li>
</ul>
<p>To launch, change to this directory and run <code>docker-compose up</code>. The initial setup will take a long time. If that fails, Ctrl+C out, run <code>docker-compose down</code>, remove <code>./TGS_Instances</code> and <code>./Database</code>, and try again. Once setup is complete, you can either leave the terminal running, or <code>Ctrl+C</code> out (this will stop DreamDaemon) and run <code>docker-compose -d</code> to run it in the background.</p>
<p>What it does:</p>
<ul>
<li>Starts mariadb with the data files in <code>./Database</code> on port 3306</li>
<li>Installs and starts Tgs4 (using latest stable docker tag, no HTTPS) on port 5000. Configuration in <code>./TGS_Config</code>, logs in <code>./TGS_Logs</code>.</li>
<li>Configures a TGS instance for tgstation in <code>./TGS_Instances</code> (SetupProgram)
<ul>
<li>The instance is configured to autostart</li>
<li>Repo is cloned from the origin specified in the <code>docker-compose.yml</code></li>
<li>BYOND version is set to the latest one specified in the <code>docker-compose.yml</code></li>
<li>A script will be run to setup dependencies. This does the following every time the game is built:
<ul>
<li>Reads dependency information from <code>dependencies.sh</code> in the root of the repository</li>
<li>Installs the following necessary packages into the TGS image
<ul>
<li>Rust/cargo</li>
<li>git</li>
<li>cmake</li>
<li>grep</li>
<li>g++-6</li>
<li>g++-6-multilib</li>
<li>mysql-client</li>
<li>libmariadb-dev:i386</li>
<li>libssl-dev:i386</li>
</ul>
</li>
<li>Builds rust-g in <code>./TGS_Instances/main/Configuration/EventScripts/rust-g</code> and copies the artifact to the game directory.</li>
<li>Builds BSQL in <code>./TGS_Instances/main/Configuration/EventScripts/BSQL</code> and copies the artifact to the game directory.</li>
<li>Sets up <code>./TGS_Instances/main/Configuration/GameStaticFiles/config</code> with the initial repository config.</li>
<li>Sets up <code>./TGS_Instances/main/Configuration/GameStaticFiles/data</code>.</li>
<li>If it doesn't exist, create the <code>ss13_db</code> database on the mariadb server and populate it with the repository's.</li>
</ul>
</li>
<li>Start DreamDaemon and configure it to autostart and keep it running via TGS.</li>
<li>Updates will be pulled from the default repository branch and deployed every hour</li>
</ul>
</li>
</ul>
<p>What it DOESN'T do:</p>
<ul>
<li>Configure sane MariaDB security</li>
<li>TGS Test merging</li>
<li>TGS Chat bots</li>
<li>Handle updating BYOND versions</li>
<li>Handle updating the database schema</li>
<li>Manage TGS users, permissions, or change the default admin password</li>
<li>Provide HTTPS for TGS</li>
<li>Expose the DB to the internet UNLESS you have port 3306 forwarded for some ungodly reason</li>
<li>Port forward or setup firewall rules for DreamDaemon or TGS</li>
<li>Notify you of TGS errors past initial setup</li>
<li>Keep MariaDB logs</li>
<li>Backup ANYTHING</li>
<li>Pretend like it's a long term solution</li>
</ul>
<p>This is enough to host a production level server !!!IN THEORY!!! This script guarantees nothing and comes with no warranty</p>
<p>You can change the TGS_BYOND and TGS_REPO variables when setting up the first time. But further configuration must be done with TGS itself.</p>
<p>You can connect to TGS with <a href="https://github.com/tgstation/Tgstation.Server.ControlPanel/releases">Tgstation.Server.ControlPanel</a> (Binaries provided for windows, must be compiled manually on Linux).</p>
<ul>
<li>Connect to <code>http://localhost:5000</code>. Be sure to <code>Use Plain HTTP</code> and <code>Default Credentials</code></li>
</ul>
<p>You should learn how to manually setup TGS if you truly want control over what your server does.</p>
<p>You have been warned.</p></td></tr></table></main><footer>tgstation.dme <a href="https://github.com/Sandstorm-Station/Sandstorm-Station-13/tree/539d57aa8436b2cbc5e4f4e4a7ff302ebce6064d">539d57a</a> (master) â€” <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.9.0</a></footer></body></html>